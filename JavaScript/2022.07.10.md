# 실행 컨텍스트(Execution Context)

- 실행 컨텍스트란 실행할 코드에 들어있는 환경 정보들을 제공하는 객체를 말함


## 실행 컨텍스트란(Execution Context)?

- 실행 컨텍스트는 환경 정보들을 모아 구성하고 콜스택에 쌓아 올리는데, 이 구조는 스택의 방식과 같다. 코드가 순차적으로 실행되며, 전체 코드의 환경과 순서를 보장함
- 식별자 결정을 더욱 효율적으로 하기 위한 수단임

식별자 결정 - 변수, 함수 값을 결정하는 것


## 실행 컨텍스트와 콜스택

```
// ----------------(1) 전역컨텍스트
let a = 1;
function inner() {
    console.log("1:", a); //Reference Error
    let a = 3;
  }
  inner(); // ----------(2) inner() 함수 실행
function outer() {
  console.log("2:", a); //1
}
outer(); // -----------(3) outer() 함수 실행
console.log("3:", a); // 1
```


1. 자바스크립트 코드를 실행하는 순간 전역 컨텍스트가 콜 스택에 담김

2. outer 함수가 호출되면 자바스크립트 엔진은 outer 함수에 대한 실행 컨텍스트를 생성해서 콜스택에 담는다. 콜스택에는 가장 최근에 추가된 실행 컨텍스트만 활성화됨

(스택과 같이 위에서 내려봤을때 보이는 것이 활성화된 실행 컨텍스트이다.)

3. inner 함수가 호출되면 또 실행 컨텍스트를 생성해 콜스택에 담음

4. inner 함수의 관련된 코드를 순차적으로 실행하고, 실행을 마치면 종료됨. 그리고 inner 함수는 콜 스택에서 사라짐

5. outer 함수도 마찬가지로 실행을 마치면 콜스택에서 사라짐

6. 전역에 있는 코드가 마지막 코드까지 실행되면 전역 컨텍스트도 사라짐



## 실행 컨텍스트의 환경 정보

- 실행 컨텍스트에는 코드가 실행 될 때 환경 정보가 담겨 있는데, 3가지가 있음

- VariableEnvironment - 현재 컨텍스트 내의 식별자(함수, 변수)에 대한 정보 및 외부 정보. 선언 시점의 스냅샷이므로 변경 사항은 반영되지 않음

실행 컨텍스트를 생성할 때 variableEnvironment에 정보를 담고, 그대로 복사해 LexicalEnvironment를 만든다. 그 이후에는 주로 렉시컬 환경에서 활용하게 됨

- LexicalEnvironment - 처음에는 VariableEnvironment 와 같지만 변경 사항이 실시간으로 반영됨

ThisBinding - 식별자가 바라보는 대상 객체



### 렉시컬 환경(Lexical Environment)

1. 환경 레코드(Environment Record)

- 식별자와 식별자에 바인딩된 값을 기록함

- 현재 컨텍스트와 관련된 코드의 식별자 정보들이 저장되므로 호이스팅이 일어남

2. 외부 환경 참조(outerEnvironmentReference)

- 지역 내에서 참조할 값이 없을 경우 프로퍼티에 접근해서 외부 렉시컬 환경을 참조하게 되는데, 값이 없을 경우 최상위 렉시컬 환경까지 검색하게 되는 체이닝 과정이 일어난다.


## 실행 컨텍스트의 생성 과정

```
1.
// ----------------전역
let computer = true;

// ----------------함수 선언문이므로 함수 전체가 환경 레코드에 기록됨
function step1(){
	let computer = false;

// ----------------이때 값을 어떤 값으로 결정해야 할지 고민함
	console.log(computer); //false
}

step1();
```

- {computer : true} 가 실행 컨텍스트에 담기게 되고, step1 함수는 선언문이므로 함수 전체가 환경 레코드에 기록이 된다. 함수가 실행되면 새로운 실행 컨텍스트를 생성함

- 자바스크립트 엔진이 computer 둘 중 어떠한 값으로 결정해야 할지 고민을 하게 되는데, 이때 식별자 결정을 하게 됨

- 동일한 함수, 값이 있을 때 자바스크립트 엔진은 outer를 사용함

- 자바스크립트 엔진은 함수를 실행하고 생성된 새로운 실행 컨텍스트에 바깥 렉시컬 환경으로 갈 수 있는 outer를 놓음

- 이전 실행 컨텍스트에 환경 레코드에 저장된 식별자도 참조 할 수 있게 됨

- 이때, computer를 찾았으면 더 이상  computer를 찾지 않게 됨



```
2.
// ----------------function step1
// ----------------전역
let computer = false;

// ----------------함수 선언문이므로 함수 전체가 환경 레코드에 기록된다.
function step2(){
	...
}

step2();
```

- 그 다음은 step2 함수가 기록되고 step1 함수 안에서 다시 step2 함수가 호출됨

- step2 함수가 호출되면 또 새로운 실행 컨텍스트가 생성됨

- 이전 렉시컬 환경을 가리키던 outer는 현재 실행 컨텍스트에 저장함




```
3.
// ----------------function step2
function step2(){
	let language = 'korean';

	console.log(language); //korean
	console.log(animal); // Reference Error
}
```

- step2 함수가 실행되면 language에 korean를 할당함

- 이때 language 값을 출력 하려고 하면, 자바스크립트 엔진은 환경 레코드를 살펴본 뒤 찾으면 출력함

- animal 를 출력하려고 하면 값이 없기 때문에 최상위로 올라가서 찾아봄

- 값이 없으면 outer가 가리키는 바깥 렉시컬 환경으로 가서 찾아봄



## 스코프 체인

이와 같이 실행 컨텍스트가 쌓여 있을 때,

안에서부터 바깥으로 차례대로 찾아 나가는 것을 스코프 체인이라고 함

## 스코프 체이닝

찾아 나가는 과정을 뜻함
